# 课程二：Agentic Payments - 让 AI Agent 能花钱和收钱

2025 年，AI Agent 正在学会花钱。这门课教你构建 Agent 支付闭环。

## 为什么 Agent 需要支付能力？

- Agent 要调用付费 API（GPT-5、数据源、计算资源）
- Agent 要提供付费服务（你的 Agent 也能赚钱）
- Agent 之间需要结算（A2A 经济）

没有支付能力的 Agent，只能调用免费资源。有支付能力的 Agent，能接入整个互联网经济。

学完你能：
- 给 Agent 配置钱包，设定消费限额和权限
- 让 Agent 自动发现价格、完成支付、调用服务
- 把你的 API 包装成 Agent 可调用的付费服务
- 从其他 Agent 那里收款
- 理解 Agent 经济的完整技术栈

## 前置要求

了解 USDC/ERC20，有后端开发经验（Node.js/Python）。

---

## Part 1：Agent 经济全景（3 讲）

先看全局，再学细节。理解 Agent 经济的技术栈。

1. Agent 经济的四层架构
   - 发现层：Agent 怎么找到彼此（A2A、ANP、Almanac）
   - 通信层：Agent 怎么互相调用（MCP、ACP）
   - 支付层：Agent 怎么结算（x402、AP2）
   - 结算层：链上资产（USDC on Base/Solana）

2. 协议对比：MCP vs A2A vs ANP vs ACP
   - 各自解决什么问题
   - 中心化 vs 去中心化发现
   - 为什么支付层是关键

3. 去中心化 Agent 身份与发现
   - Fetch.ai Almanac：链上 Agent 注册表
   - ERC-8004：Agent 链上身份标准
   - 未来方向：完全去中心化的 Agent 市场

## Part 2：Agent 钱包与权限（4 讲）

Agent 花钱的前提：有钱包，有权限控制。

技术栈：Safe Protocol、Skyfire、Privy

4. Agent 钱包架构：自托管 vs 托管，私钥管理方案
5. Safe 多签与模块：给 Agent 有限权限，人类保留控制
6. Session Keys：临时授权，限额限时限范围
7. 实战：为 Agent 创建一个有消费限额的钱包

## Part 3：x402 支付协议（5 讲）

Agent 怎么付钱？x402 是当前最成熟的方案。

技术栈：x402 Protocol、USDC on Base

8. x402 原理：HTTP 402 状态码，支付挑战与凭证
9. x402 客户端：Agent 自动发现价格、签名付款
10. 支付安全：幂等、重放保护、失败重试
11. A2A x402：Agent 之间互相调用并结算
12. 实战：让 Agent 自动调用付费 API

## Part 4：服务端收款（4 讲）

你的 API 怎么从 Agent 那收钱？

技术栈：x402 Server SDK、Nevermined

13. x402 服务端：给 API 加计费中间件
14. 定价策略：按次、按量、按时间
15. 收款确认与对账：链上验证、状态同步、资金归集
16. 实战：把现有 API 改造成 Agent 可付费调用

## Part 5：Guided Project（5 讲）

项目：构建一个 Agent 支付闭环

场景：你有一个数据 API，想让 AI Agent 能付费调用。

17. 项目设计：需求分析、架构设计
18. 服务端开发：x402 计费中间件 + 业务 API
19. Agent 客户端：钱包配置 + 自动支付调用
20. 监控运维：收款统计、用量分析、告警
21. 部署上线：测试网验证 → 主网部署

---

## 交付物

- Agent 钱包配置模板（Safe + Session Keys）
- x402 服务端中间件（Express/Hono）
- Agent 付费调用客户端
- 收款对账脚本
- 部署文档

## 市场时机

- Coinbase 2025 年 5 月发布 x402，6 个月处理 1 亿+ 笔支付
- Cloudflare + Coinbase 成立 x402 Foundation
- Google AP2、Visa、Anthropic 都在采用
- 美国/香港 2025 年稳定币法案落地

## 与其他课程的关系

- 课程一（稳定币协议）→ 理解 USDC 是什么
- 课程二（本课）→ Agent 怎么花 USDC / 收 USDC
- 课程三（AI Agent 交易）→ Agent 怎么用 USDC 做交易策略
